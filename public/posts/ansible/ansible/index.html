<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Ansible Main | ExampleSite</title>
<meta name=keywords content><meta name=description content="Push model
Ruby based
demon less
Procedural
it creates top to bottom Architecture Controller node (only this requires ansible) This are the inventory and are in the ansible configuration file
smaller servers network devices kuberntetss public and private cloud Can do windows automation on windows
It has to hav python isntalled on the machines Plugins/Modules To list modules use ansiable-doc -l To get the help of the particular module use ansible-doc -s <module>"><meta name=author content="Me"><link rel=canonical href=http://localhost:1313/posts/ansible/ansible/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/ansible/ansible/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Ansible Main</h1><div class=post-meta><span title='2024-07-22 09:10:24 +0200 CEST'>July 22, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;643 words&nbsp;·&nbsp;Me</div></header><div class=post-content><p><strong>Push model</strong></p><ul><li><p>Ruby based</p></li><li><p><em><strong>demon less</strong></em></p></li><li><p><strong>Procedural</strong></p><ul><li>it creates top to bottom</li></ul></li></ul><h2 id=architecture>Architecture<a hidden class=anchor aria-hidden=true href=#architecture>#</a></h2><ol><li>Controller node (<em>only this requires ansible</em>)<ul><li><p>This are the <em>inventory</em> and are in the ansible configuration file</p><ul><li>smaller servers</li><li>network devices</li><li>kuberntetss</li></ul></li><li><p>public and private cloud
<strong>Can do windows automation on windows</strong></p></li></ul></li></ol><ul><li>It has to hav <strong>python</strong> isntalled on the machines</li></ul><h3 id=pluginsmodules>Plugins/Modules<a hidden class=anchor aria-hidden=true href=#pluginsmodules>#</a></h3><p>To list modules use <code>ansiable-doc -l</code>
To get the help of the particular module use <code>ansible-doc -s &lt;module></code></p><ul><li><em>inventory plugins</em><ul><li>organize managed host to different kinds of inventory</li></ul></li><li><em>connection plugins</em><ul><li>How does Ansaible controller connect to the host<ul><li>example ssh plugin</li><li>for windows <strong>winrm</strong> plugin</li></ul></li></ul></li><li><em>become</em><ul><li>what user u would like to become<ul><li>sudo</li><li>run as</li></ul></li></ul></li><li><em>vars</em>
reference how we make use of variables</li><li><em>lookup</em>
different <em>data sources</em></li><li><em>callback</em>
This just logs</li><li><em>cache</em></li></ul><h3 id=ansible-configuration>Ansible configuration<a hidden class=anchor aria-hidden=true href=#ansible-configuration>#</a></h3><ol><li>ansible.cfg in the current directory</li><li><strong>ANSIBLE_CONFIG</strong> environment var</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Provides also current config file in use</span>
</span></span><span class=line><span class=cl>ansible --version
</span></span></code></pre></div><h3 id=example-config>Example config<a hidden class=anchor aria-hidden=true href=#example-config>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>poetry2nix</span><span class=o>.</span><span class=n>mkPoetryEnv</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>projectDir</span> <span class=o>=</span> <span class=sr>./.</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>overrides</span> <span class=o>=</span> <span class=n>poetry2nix</span><span class=o>.</span><span class=n>overrides</span><span class=o>.</span><span class=n>withDefaults</span> <span class=p>(</span><span class=n>final</span><span class=p>:</span> <span class=n>prev</span><span class=p>:</span> <span class=p>{</span> <span class=n>foo</span> <span class=o>=</span> <span class=no>null</span><span class=p>;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=n>guration</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>defualts<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>inventory</span> <span class=o>=</span> ./myInventoru
</span></span><span class=line><span class=cl><span class=nv>remote_user</span> <span class=o>=</span> devovs 
</span></span><span class=line><span class=cl><span class=nv>collections_paths</span> <span class=o>=</span> ./collections/
</span></span><span class=line><span class=cl><span class=nv>collbacks_enabled</span> <span class=o>=</span> ansible.posix.profile_roles
</span></span></code></pre></div><h3 id=inventory>Inventory<a hidden class=anchor aria-hidden=true href=#inventory>#</a></h3><ul><li>U can use pass the arguments <strong>direcly to the ivnentory</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>test_server<span class=o>]</span>
</span></span><span class=line><span class=cl>control_test <span class=nv>type</span><span class=o>=</span>client
</span></span><span class=line><span class=cl>node_test <span class=nv>type</span><span class=o>=</span>server
</span></span></code></pre></div><ul><li>The beterr approach is to use the <code>ansible_hostname</code><ul><li>since it first performs <em>uname -n</em></li></ul></li></ul><p>To use the <strong>host group</strong> for the playbook use <code>inventory_hostname</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  hosts: home_machines
</span></span><span class=line><span class=cl>  vars:
</span></span><span class=line><span class=cl>    user_home: <span class=s2>&#34;/home/{{ inventory_hostname }}&#34;</span>
</span></span></code></pre></div><h4 id=diffrences>Diffrences<a hidden class=anchor aria-hidden=true href=#diffrences>#</a></h4><p><img loading=lazy src=/static/a_hostname_vs_in_hostname.png alt="Ansiable hosname vs inventory_hostname"></p><p><a href=https://www.middlewareinventory.com/blog/ansible-inventory_hostname-ansible_hostname-variables/>Docs</a></p><p><a href=https://blog.christophersmart.com/2022/04/03/using-a-dynamic-libvirt-inventory-with-ansible/>Using a dynamic libvirt inventory with Ansible</a></p><p>Example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># to show use ansible-invetory --graph or --list in json output </span>
</span></span><span class=line><span class=cl><span class=o>[</span>webserver<span class=o>]</span>
</span></span><span class=line><span class=cl>servera
</span></span><span class=line><span class=cl>servec
</span></span><span class=line><span class=cl><span class=o>[</span>dbservers<span class=o>]</span>
</span></span><span class=line><span class=cl>servdb
</span></span><span class=line><span class=cl><span class=c1>##Nested groups </span>
</span></span><span class=line><span class=cl><span class=o>[</span>Nested:children<span class=o>]</span>
</span></span><span class=line><span class=cl>webserver
</span></span><span class=line><span class=cl>dbservers
</span></span></code></pre></div><h3 id=playbooks>Playbooks<a hidden class=anchor aria-hidden=true href=#playbooks>#</a></h3><p>(rember to check for the sytnax issues <code>--sytnax check</code> )
<strong>They are run top to bottom</strong>
[!bug] By default ansible <em>panics when error</em></p><ul><li><strong>Task</strong> is just a <strong>task</strong> that has to be done can use modules</li><li><strong>Role</strong> is just the <strong>directory</strong> with the instructions<ul><li>Highly parametric-seized</li><li><em>Works with vars</em></li><li>Can mix both</li></ul></li></ul><h4 id=handlers>Handlers<a hidden class=anchor aria-hidden=true href=#handlers>#</a></h4><ul><li>They are executing in an order that there were <strong>notyfied</strong> in</li><li>The handlesr executes only once no matter the amount of <em>task calling</em><ul><li>If <strong>force_handlers</strong> enabled then handlers will execute no matter the error</li></ul></li></ul><h5 id=example>Example<a hidden class=anchor aria-hidden=true href=#example>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Kernel Update</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>force_handlers</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Ensure kernel is updated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Add task</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>handlers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Ensure system is rebooted</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.reboot</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Rebooting due to a kernel update&#34;</span><span class=w>
</span></span></span></code></pre></div><h3 id=facts-and-conditionals>Facts and conditionals<a hidden class=anchor aria-hidden=true href=#facts-and-conditionals>#</a></h3><p><a href=https://www.golinuxcloud.com/ansible-facts/>Docs</a></p><h4 id=gathering-info>Gathering info<a hidden class=anchor aria-hidden=true href=#gathering-info>#</a></h4><p><em>Gathering facts may be constly</em> use <strong>setup</strong> for the specyfic machines u want to chekout</p><ul><li>If <strong>gather_facts</strong> enabled we can use uthis to veryfie facts of the systme<ul><li>And set the taks blocks acordingly</li></ul></li><li>use <strong>when</strong> for the conditoals</li><li>or vars with the <strong>assert</strong> module</li></ul><p><a href=https://www.coursera.org/learn/fundamentals-of-ansible/lecture/u0iXX/using-conditionals>Docs</a></p><p>Ex</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>gather_facts</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>task</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Veryfie that this si the debian dirsto </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#39;Debian&#39; is ansiable_fact[&#39;distribiution&#39;]&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>block</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>This is Debian</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span>- <span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=l>This is Debian </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          
</span></span></span></code></pre></div><h4 id=user-defined-facts>User defined facts<a hidden class=anchor aria-hidden=true href=#user-defined-facts>#</a></h4><p>Create <code>/etc/ansible/facts.d</code> on the <em>managed nodes</em></p><ul><li>The file has tave to have <strong>.file</strong> extentsion</li><li>Has to be in the <strong>Json Format</strong></li></ul><h3 id=plugins>Plugins<a hidden class=anchor aria-hidden=true href=#plugins>#</a></h3><p>Uses ansiable-<strong>galaxy</strong>
They provied modules like for example to work with <a href=https://docs.ansible.com/ansible/latest/collections/community/libvirt/index.html>Libvirt</a></p><h4 id=ansiable-with-nix>Ansiable with nix<a hidden class=anchor aria-hidden=true href=#ansiable-with-nix>#</a></h4><p>Rember to install stuff in the as root user profile then the user can use the softerwe and also add the nix path to <strong>sudo path</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Defaults   <span class=nv>secure_path</span><span class=o>=</span><span class=s2>&#34;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/nix/var/nix/profiles/default/bin&#34;</span>
</span></span></code></pre></div><h3 id=pacages>Pacages<a hidden class=anchor aria-hidden=true href=#pacages>#</a></h3><p>U can use a bulti in <strong>.package</strong> module to install different packages</p><p><a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/package_module.html#examples>Example</a></p><h3 id=vault-pass>Vault pass<a hidden class=anchor aria-hidden=true href=#vault-pass>#</a></h3><p>Using Ansible Vault with a Password File
If you do not wish to type in the Vault password each time you execute a task, you can add your Vault password to a file and reference the file during execution.</p><p>For example, you could put your password in a .vault_pass file like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;my_vault_password&#39;</span> &gt; .vault_pass
</span></span></code></pre></div><p>If you are using version control, make sure to add the password file to your version control software’s ignore file to avoid accidentally committing it:
<a href=https://www.digitalocean.com/community/tutorials/how-to-use-vault-to-protect-sensitive-ansible-data#using-ansible-vault-with-a-password-file>Ansaible vault with the password file</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible-playbook  main.yml -i inventory   --vault-password-file<span class=o>=</span>.vault_pass
</span></span></code></pre></div><hr><p><a href=http://localhost:1313/posts/teraform/>Teraform</a></p><p><a href=http://localhost:1313/posts/puppet/>Puppet</a></p><p><a href=http://localhost:1313/posts/ansible/ansible_commands/>Ansible commands</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/ansible/ansible_libvrd/><span class=title>« Prev</span><br><span>Ansible Libvrd</span>
</a><a class=next href=http://localhost:1313/posts/ansible/ansible_vars/><span class=title>Next »</span><br><span>Ansible Varaibles</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>ExampleSite</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>