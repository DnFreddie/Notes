<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>the_world_doesn_t_end_with_scripting | ExampleSite</title>
<meta name=keywords content><meta name=description content="When you start your Linux journey or follow Linux-based YouTubers, you often hear them praising the benefits of writing scripts.
They encourage you to create your own scripts for various tasks because
&ldquo;scripts are simple yet powerful tools to get your work done.&rdquo;
They suggest downloading and using scripts to experience these benefits firsthand, advocating for Bash as the go-to scripting language due to its versatility and ease of use."><meta name=author content="Me"><link rel=canonical href=http://localhost:1313/posts/posts/the_world_doesn_t_end_with_scripting/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/posts/the_world_doesn_t_end_with_scripting/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">the_world_doesn_t_end_with_scripting</h1><div class=post-meta><span title='2024-07-22 09:10:24 +0200 CEST'>July 22, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1178 words&nbsp;·&nbsp;Me</div></header><div class=post-content><p>When you start your Linux journey or follow Linux-based YouTubers, you often hear them praising the benefits of writing scripts.</p><p>They encourage you to create your own scripts for various tasks because</p><p><strong>&ldquo;scripts are simple yet powerful tools to get your work done.&rdquo;</strong></p><p>They suggest downloading and using scripts to experience these benefits firsthand, advocating for Bash as the go-to scripting language due to its versatility and ease of use.</p><p>However, what they don&rsquo;t mention is&mldr;</p><h2 id=the-misinterpretation>The Misinterpretation<a hidden class=anchor aria-hidden=true href=#the-misinterpretation>#</a></h2><p><img loading=lazy src="https://firebasestorage.googleapis.com/v0/b/fbase-2d77d.appspot.com/o/assets%2Fworld_end_scripting%2Fscritpts_header.jpg?alt=media&amp;token=b33f2740-203f-4a06-bca2-9db0e00545d4" alt="Oh Scripts"></p><p>The first thing to keep in mind is that shell scripts shouldn&rsquo;t be the primary source of automation.</p><p>What I want you to associate scripts with is</p><ul><li><p><strong>quick and dirty</strong> tasks</p></li><li><p><strong>verifying something</strong> fast.</p></li></ul><p>The reason is shell scripting lacks built-in mechanisms for these four things:</p><ol><li><p>Scripts are hard to read due to complex Bash syntax.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Example</span>
</span></span><span class=line><span class=cl><span class=nv>a</span><span class=o>=</span><span class=s2>&#34;Hello&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>b</span><span class=o>=</span><span class=s2>&#34;World&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>c</span><span class=o>=</span><span class=nv>$a</span><span class=s2>&#34; &#34;</span><span class=nv>$b</span>
</span></span><span class=line><span class=cl><span class=nv>d</span><span class=o>=</span><span class=nv>$b</span><span class=s2>&#34; &#34;</span><span class=nv>$a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>e</span><span class=o>=</span><span class=nv>$c</span><span class=s1>$&#39;\n&#39;</span><span class=nv>$d</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -n <span class=s2>&#34;</span><span class=nv>$e</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=p>|</span> sed -e <span class=s1>&#39;s/o/O/g&#39;</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=p>|</span> <span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span><span class=s1>$&#39;\n&#39;</span> <span class=nb>read</span> -r line<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$line</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div></li><li><p>People can easily inject variables into your code, even when using tools like <a href=https://www.shellcheck.net/>ShellCheck</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Vulnerable code</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Enter your name:&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>read</span> name
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Hello, </span><span class=nv>$name</span><span class=s2>!&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># All I have to do is type</span>
</span></span><span class=line><span class=cl><span class=sb>`</span>John<span class=p>;</span> <span class=nb>echo</span> <span class=s2>&#34;Haha, I injected a command!&#34;</span><span class=sb>`</span>,
</span></span><span class=line><span class=cl><span class=c1># and you know what the output will look like...</span>
</span></span></code></pre></div></li><li><p>Error handling is minimal, apart from <em>test statements</em> or exit <em>codes</em>.</p></li><li><p>Bash is slow; what works for 100 repetitions doesn&rsquo;t work for a million.</p></li></ol><p>The universal rule is:</p><p><strong>If your script is longer than 40 lines, use a programming language.</strong></p><h2 id=so-whats-the-alternatvie-then>So what&rsquo;s the alternatvie then?<a hidden class=anchor aria-hidden=true href=#so-whats-the-alternatvie-then>#</a></h2><p><img loading=lazy src="https://firebasestorage.googleapis.com/v0/b/fbase-2d77d.appspot.com/o/assets%2Fworld_end_scripting%2Fasniblle_logo.jpg?alt=media&amp;token=e48af70a-e052-42af-8a62-8e0b4141c16e" alt="ansible logo"></p><p>Typically, when you start automating tasks like setting up virtual machines and managing dot-files, you want them to be set up quickly, especially when you&rsquo;re unsure which hypervisor tools to use. You can either set up a dot-files repository with scripts that symlink things to proper places or do it manually for every VM.</p><p>Some of you may have built scripts around SSH.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh user@hostname <span class=s2>&#34;apt install ...&#34;</span>
</span></span></code></pre></div><p><strong>But this isn&rsquo;t maintainable.</strong></p><p>As your home lab grows, you&rsquo;ll have more things to configure simultaneously: different machines, package managers, environments, and different types of errors.</p><p>Trust me, elaborate scripts won&rsquo;t hold up. You need a better tool. Here comes Ansible, a daemon-less solution&mldr;</p><p>So, it&rsquo;s quite simple. Ansible is built around pushing changes using a tool you already love <strong>SSH</strong>.</p><p>Ansible connects to the selected machine and pushes changes based on instructions stored in a YAML file, called a playbook.</p><p>No matter how many machines you have, Ansible is quick, simple, and nice, without the need to install any daemon on the nodes.</p><h2 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h2><p>Installing Ansible is relatively simple. You have two approaches:</p><ol><li>Treat Ansible as a project with its own <strong>virtual environment</strong>.</li><li>Install it as a <strong>system-wide package</strong>.</li></ol><p>You might think the second option, global installation, is far superior.</p><p>However, Ansible uses Python modules installed on your system.</p><p>Imagine needing to install a Python library for virtualization.</p><p>You&rsquo;d have to install it system-wide, which could lead to <strong>compatibility issues</strong> later.</p><p>Moreover, you&rsquo;re giving administrative privileges to the package.</p><p>If the package is malicious or contains vulnerabilities, it can exploit those privileges.</p><p><strong>Installation Methods</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install ansible
</span></span></code></pre></div><p><strong>Or with virtual env:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install virtualenv
</span></span><span class=line><span class=cl>virtualenv ansible-env
</span></span><span class=line><span class=cl><span class=nb>source</span> ansible-env/bin/activate
</span></span><span class=line><span class=cl>pip install ansible
</span></span><span class=line><span class=cl>pip install ansible-core
</span></span></code></pre></div><h3 id=inventory>Inventory<a hidden class=anchor aria-hidden=true href=#inventory>#</a></h3><p>I&rsquo;m sure you&rsquo;ve already added your lab machines to the SSH config so you can easily SSH into them.</p><p>If you haven&rsquo;t, here&rsquo;s how to do it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Create a config file in ~/.ssh and add the following lines for hosts</span>
</span></span><span class=line><span class=cl>Host ChooseAnyName
</span></span><span class=line><span class=cl>    HostName ip_address
</span></span><span class=line><span class=cl>    User username_to_connect_as
</span></span><span class=line><span class=cl>    IdentityFile ~/.ssh/private key
</span></span></code></pre></div><p>Remember to change the authorization method on your server to PublicKey, so you wouldn&rsquo;t have to <code>--ask-pass</code> every time you want to use Ansible.</p><p>Now, having done all of this, you need to create a file called <code>inventory</code> and add the host names to it.
This tells Ansible which device to SSH into and perform tasks.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>home</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>dnf</span>
</span></span><span class=line><span class=cl><span class=nx>my_machine1</span>
</span></span><span class=line><span class=cl><span class=nx>my_machine2</span>
</span></span></code></pre></div><p><strong>[home]</strong> is the name of the group, so you don&rsquo;t have to call each machine manually one by one.</p><h2 id=focus-on-debugging-first>Focus on Debugging First<a hidden class=anchor aria-hidden=true href=#focus-on-debugging-first>#</a></h2><p>We won&rsquo;t write any serious playbooks in this post;
I&rsquo;ll leave that for another time.
But I want you to understand Ansible&rsquo;s modularity and its debugging potential so you can apply quick fixes without writing the whole playbook.</p><h2 id=ansible-ad-hoc-and-modularity>Ansible Ad Hoc and Modularity<a hidden class=anchor aria-hidden=true href=#ansible-ad-hoc-and-modularity>#</a></h2><p><img loading=lazy src="https://firebasestorage.googleapis.com/v0/b/fbase-2d77d.appspot.com/o/assets%2Fworld_end_scripting%2Fmodularity.jpg?alt=media&amp;token=8c977b9d-33aa-4c84-bf32-eda093cc8df0" alt=modularity></p><p>Ansible itself is a <strong>suite of tools and modules</strong>.</p><p>You have different commands for different tasks.</p><p>For example, to get knowledge about a particular module, you use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible-docs -s module_name
</span></span></code></pre></div><p>Modules work similarly to Python modules.</p><p>You can call modules alone using the <code>-m</code> flag.</p><p>One popular example is the <strong>venv</strong> package, which creates a virtual environment for Python:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python -m venv /path/to/new/virtual/environment
</span></span></code></pre></div><p>Similarly, in Ansible, you use this pattern:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible home -i path_to_inventory -m module_name -a <span class=s1>&#39;module arguemnt&#39;</span>
</span></span></code></pre></div><p>There are thousands of modules in Ansible, but I want to focus on two that will be most useful for you:</p><ul><li><a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/setup_module.html>Setup Module</a></li><li><a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html>Shell Module</a></li></ul><h3 id=setup-quick-and-dirty>Setup Quick and Dirty<a hidden class=anchor aria-hidden=true href=#setup-quick-and-dirty>#</a></h3><p><img loading=lazy src="https://firebasestorage.googleapis.com/v0/b/fbase-2d77d.appspot.com/o/assets%2Fworld_end_scripting%2FsetupAns.jpg?alt=media&amp;token=4d2e906f-1dbf-43c9-8235-9b998fcf2992" alt="Ansible setup graphic "></p><p>There are many situations where you&rsquo;d like to quickly gather information about your infrastructure.</p><p>Are all your machines working? What&rsquo;s their uptime? Do they have the right kernel version?</p><p>Here are the all possible <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/setup_module.html#parameters>options</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible <span class=nb>test</span> -i inventory -m setup -a <span class=s1>&#39;filter=user_id&#39;</span>
</span></span><span class=line><span class=cl>ansible <span class=nb>test</span> -i inventory -m setup -a <span class=s1>&#39;filter=kernel&#39;</span>
</span></span><span class=line><span class=cl>ansible <span class=nb>test</span> -i inventory -m setup -a <span class=s1>&#39;filter=ansible_distribution&#39;</span>
</span></span></code></pre></div><h3 id=ansible-can-be-sneaky>Ansible Can Be Sneaky<a hidden class=anchor aria-hidden=true href=#ansible-can-be-sneaky>#</a></h3><p>You might think Ansible processes tasks one by one, but it actually handles them in parallel.</p><p>By default, it handles 5 machines, but you can specify more by adding the <code>-f</code> flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible <span class=nb>test</span> -i inventory -m setup -a <span class=s1>&#39;filter=user_id&#39;</span> -f <span class=m>10</span>
</span></span></code></pre></div><p>It also hides what it&rsquo;s really doing, which could make extended debugging challenging.</p><p>Therefore, you have to explicitly call it with the verbosity flag.</p><p><strong>It has up to 6 &lsquo;v&rsquo;s</strong> !!!, but a reasonable level to start is <code>-vvv</code>, feel free to go wild:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible <span class=nb>test</span> -i inventory -m setup -a <span class=s1>&#39;filter=user_id&#39;</span> -vvvvvv
</span></span></code></pre></div><h3 id=finally-back-to-bash>Finally, Back to Bash<a hidden class=anchor aria-hidden=true href=#finally-back-to-bash>#</a></h3><p><img loading=lazy src="https://firebasestorage.googleapis.com/v0/b/fbase-2d77d.appspot.com/o/assets%2Fworld_end_scripting%2Fbash_matrix.jpg?alt=media&amp;token=6b720cd9-8fe6-4bf2-bcc1-53c6f58eebc1" alt="Bash matrix"></p><p>This is the most dirty and basic but very useful.
If you have a custom script you want to run or if there&rsquo;s no Ansible module that suits your needs.</p><p>You can <strong>call Bash directly</strong> on the device with the shell module:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible <span class=nb>test</span> -i inventory -m shell -a <span class=s1>&#39;any_command_you_desire&#39;</span>
</span></span></code></pre></div><p>However, there&rsquo;s a catch:</p><p><strong>Ansible doesn&rsquo;t control the output.</strong></p><p>It executes the command and checks for errors but always produces a changed result, no matter what the command is.</p><h3 id=to-sum-up>To Sum Up<a hidden class=anchor aria-hidden=true href=#to-sum-up>#</a></h3><p>Bash scripts have their time and place but are not the one and only solution, especially for something you may use on multiple devices.</p><p>Try something more stable that won&rsquo;t shoot you in the foot but guide you.</p><p>Really, Ansible is awesome, and that&rsquo;s just the beginning of its possibilities.</p><p>If you want to learn more about Ansible, Linux, or anything else, chekout <a href=https://killercoda.com/het-tanis/course/Ansible-Labs>killercoda labs</a></p><p>They are free, no need for login, and will walk you through everything without setting up the environment.</p><p>Also, join their <a href=https://discord.com/invite/bn4TxafhSH>Discord channel</a> because they&rsquo;re doing a fantastic job educating about Linux.</p><p>Peace out :) Hope to see you there!</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/posts/the_only_journal_worth_reading/><span class=title>« Prev</span><br><span>the_only_journal_worth_reading</span>
</a><a class=next href=http://localhost:1313/posts/for_later/threads/><span class=title>Next »</span><br><span>threads</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>ExampleSite</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>