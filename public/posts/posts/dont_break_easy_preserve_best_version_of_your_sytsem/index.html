<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>dont_break_easy_preserve_best_version_of_your_sytsem | ExampleSite</title>
<meta name=keywords content><meta name=description content="I&rsquo;m sure you remember the feeling of your perfect setup.
Special ordered coffee from Network Chuck.
The thrill of the customized Xmonad guessing your current mood and selecting the wallpaper accordingly.
All VSCode themes and plugins meticulously selected.
The urge to spout code like there&rsquo;s no tomorrow.
You open your computer
Only to realize the disk is corrupted and all is gone&mldr;
There&rsquo;s no turning back unless you have a photographic memory"><meta name=author content="Me"><link rel=canonical href=http://localhost:1313/posts/posts/dont_break_easy_preserve_best_version_of_your_sytsem/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/posts/dont_break_easy_preserve_best_version_of_your_sytsem/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">dont_break_easy_preserve_best_version_of_your_sytsem</h1><div class=post-meta><span title='2024-07-22 09:10:24 +0200 CEST'>July 22, 2024</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1530 words&nbsp;·&nbsp;Me</div></header><div class=post-content><p><img loading=lazy src=/blog_imgs/brokenComputer.jpg alt="Broken system"></p><p>I&rsquo;m sure you remember the feeling of your perfect setup.</p><p>Special ordered coffee from Network Chuck.</p><p>The thrill of the customized Xmonad guessing your current mood and selecting the wallpaper accordingly.<br>All VSCode themes and plugins meticulously selected.<br>The urge to spout code like there&rsquo;s no tomorrow.</p><p>You open your computer</p><p>Only to realize the disk is corrupted and all is gone&mldr;</p><p>There&rsquo;s no turning back unless you have a photographic memory<br>and even then, it&rsquo;s so hard to redo this whole thing again.</p><p>What if I tell you there&rsquo;s a way to preserve your best system self?</p><p>Buy my course at www&mldr;<br>No, I&rsquo;m kidding, the recipe is simple.</p><h2 id=3-pillars-of-the-stable-system>3 pillars of the stable system<a hidden class=anchor aria-hidden=true href=#3-pillars-of-the-stable-system>#</a></h2><p>When you evaluate your environment, you have to focus on these 3 things:</p><p>1.<strong>Backup</strong> Do I maintain backups regularly?</p><p>2.<strong>Reproducibility</strong> How fast can I get it to work and deploy?</p><p>3.<strong>Portability</strong> And how easy is it to get to it?</p><h3 id=regular-backups>Regular backups<a hidden class=anchor aria-hidden=true href=#regular-backups>#</a></h3><p><img loading=lazy src=/blog_imgs/cloudBckup.jpg alt="Broken system"></p><p>It&rsquo;s the obvious one, but I&rsquo;m pretty sure there&rsquo;s one thing you forgot to do so.<br>This one photo album from summer 2019?
And that good you shouldn&rsquo;t remember at all about it&mldr;<br>No, I mean it.<br>The issue with backups is that they take a lot of mental effort to do so.<br>That&rsquo;s why you have to automate it.</p><p><strong>Stick to the basic tools</strong></p><p>I&rsquo;m sure you&rsquo;re familiar with <strong>git</strong>, you used <strong>rsync</strong> one or two times while SSHing to your Home Lab.<br>You might have heard about the cron jobs or systemd timers.<br>Why not combine all these tools?</p><p>So set up a repo backup or whatever</p><p><em>remember about creating also one more branch not only main.</em></p><p>The thing is you might change something in config that&rsquo;s not stable and later regret it.<br>And I know in git, you can revert to the particular commit, but sometimes you like all the changes except one or two on different commits&mldr;</p><p>So let&rsquo;s say that main branch is for the stable version that you generally enjoy any future changes will be on dev.</p><p><em>You can always merge them any time.</em></p><p>Then get the list of things you want to backup into one <em>.txt</em> file
and use some bash example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>while</span> <span class=nb>read</span> -r line<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>do</span>  
</span></span><span class=line><span class=cl>    rsync -av <span class=s2>&#34;</span><span class=nv>$line</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/backup&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span> &lt; backup_list.txt
</span></span></code></pre></div><h2 id=scheduling>Scheduling<a hidden class=anchor aria-hidden=true href=#scheduling>#</a></h2><p><img loading=lazy src=/blog_imgs/scheduler-min.jpg alt=Shcedules></p><p>Now you have to know a bit about the cron jobs or systemd timers.</p><p><strong>Cron jobs</strong> may be easier, but I think that having a <strong>unit</strong> is more future-proof.</p><p>-<strong>Unit</strong> in systemd is just an <em>entity that systemd manages.</em></p><p><strong>Remember we create a user unit not a root one</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir -p  ~/.config/systemd/user/
</span></span><span class=line><span class=cl>vim    ~/.config/systemd/user/backup.service
</span></span><span class=line><span class=cl>vim    ~/.config/systemd/user/backup.timer
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>Unit<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Description</span><span class=o>=</span>Backup files 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Service<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>/bin/bash -c <span class=s1>&#39;path/to/your/script&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Install<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>WantedBy</span><span class=o>=</span>network.target
</span></span></code></pre></div><p><strong>Install</strong> is just which step of the system initialization it should be executed with</p><p><em>(remember not explicitly after or before)</em>.<br>Because systemd is the <strong>parent of all the processes</strong>.<br>And it spawns them in a particular order.</p><p>Try</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl list-units --type<span class=o>=</span>target
</span></span></code></pre></div><p>Now set the timer with <strong>the same name</strong> but with <em>.timer</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>Unit<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>Description</span><span class=o>=</span>Run backup service daily
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Timer<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>OnCalendar</span><span class=o>=</span>daily
</span></span><span class=line><span class=cl><span class=nv>Persistent</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>Install<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>WantedBy</span><span class=o>=</span>default.target
</span></span></code></pre></div><p>now add your sevice and timer with</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl --user daemon-reload 
</span></span><span class=line><span class=cl>systemctl --user --now <span class=nb>enable</span> backup.timer
</span></span><span class=line><span class=cl>systemctl --user --now start backup.timer
</span></span></code></pre></div><p>And voila, we can forget about this once and for all.<br>If you&rsquo;re interested in backing up automatically on USB,
You can edit <em>/etc/fstab</em> to mount your USB in the given location on boot<br>And just add the path to rsync destination in the script</p><p><strong>But be careful and read more about <a href=https://www.redhat.com/sysadmin/etc-fstab>fstab</a> before you start experimenting.</strong></p><h1 id=reproducibility>Reproducibility<a hidden class=anchor aria-hidden=true href=#reproducibility>#</a></h1><p><img loading=lazy src=/blog_imgs/reproduciblity_meme.jpg alt="Reproduciblity meme">
It&rsquo;s great to have everything in place, but how quickly can we get it to work?</p><p>Unfortunately, the process is currently too slow.</p><p>Manually moving files and installing software is a painful experience.</p><p>Therefore, we need to create a script that processes our dotfiles, creates symlinks from the main repository to the .config and various directories, and installs executables based on a list.</p><p>(I&rsquo;m currently working on a tool to streamline this using Go.)</p><p><strong>Declarative vs Imperative Approach</strong></p><p>When we install packages and configure systems traditionally, we often take an <strong>imperative approach</strong>, making modifications directly rather than strictly defining configurations.</p><p>In the <strong>declarative</strong> approach, we predesign the system and apply the configuration, allowing for easy rebuilding after modifications.</p><p>In traditional systems, reverting to previous versions is challenging due to dependencies hell.</p><p>Thast why here comes our sponsor Nixos&mldr;</p><h3 id=nix-your-way-out>Nix: Your Way Out<a hidden class=anchor aria-hidden=true href=#nix-your-way-out>#</a></h3><p><img loading=lazy src=/blog_imgs/nixosLogo.webp alt="Nixos Logo">
Sorry, I know, I know, this isn&rsquo;t the tech coaching channel. But back to the point.</p><p><a href=https://nixos.org/>Nixos</a>, a Linux distribution , offers a completely <strong>declarative</strong> approach.</p><p>You write one configuration file called <a href=https://nixos-and-flakes.thiscute.world/>flake</a>, and it sets up everything.</p><p>It installs every program and meanges every config specified, utilizing a tool like <a href=https://github.com/nix-community/home-manager>Homenager</a>.</p><p>Additionally, it regularly creates <strong>snapshots of the enitre system</strong>, facilitating easy rollback in case of breaking changes.</p><p>Nixos also <strong>containerizes programs</strong>, isolating dependencies for easy testing and deployment.</p><p>Meaning it installs programs in a separate environment that doesn&rsquo;t share dependencies.</p><p>This makes testing ridiculously easy since you can install any app, test it, and forget about it.</p><p><em>(In the future, there will be more collaboration between NixOS and Docker.)</em></p><p>You can create a .nix script to locally run and deploy containers based on it.</p><p>The possibilities are endless.</p><p>See the <a href=https://nix.dev/tutorials/nixos/building-and-running-docker-images.html>template</a></p><h3 id=drawbacks-of-nix>Drawbacks of Nix<a hidden class=anchor aria-hidden=true href=#drawbacks-of-nix>#</a></h3><p>While powerful, Nix has limitations.
Direct binary installations are not supported, and it has a steep learning curve (<em>it doesn&rsquo;t help that the Nix language is functional</em>).</p><p>However, you can get around these issues by using <strong>flakes</strong> and <a href=https://github.com/Mic92/nix-ld>nix-id</a>.</p><p>For frequent testers or users with multiple devices, it&rsquo;s highly recommended.</p><h3 id=things-get-corupted-security-concerns>Things get corupted (Security Concerns)<a hidden class=anchor aria-hidden=true href=#things-get-corupted-security-concerns>#</a></h3><p><img loading=lazy src=/blog_imgs/heartBleed.webp alt="Bleeding heart"></p><p>These days, there are a lot of attacks on software, and particularly recently we had an affair with <a href=https://www.techradar.com/pro/website-hosting/huge-backdoor-discovered-that-could-compromise-ssh-logins-on-linux>Heartbleed 2.0</a></p><p>The vulnerability is a backdoor in the <em>xz</em> utils package.</p><p>A widely used Linux utility for compressing and decompressing files</p><p>The backdoor allows attackers to compromise SSH logins and gain unauthorized access to affected systems.</p><p>To fix this on nix, we will just revert to the previous version of the system and wait for a patch.</p><p>On another system, if we do regularly take snapshots, we can also do this.</p><p>But what happens to our GitHub projects?
Does the code need bacup mechanism outside of github ?</p><p>I know you haven&rsquo;t thought about it, have you? Neither have I.
That&rsquo;s why this will be the topic of my next blog post.</p><h3 id=portability>Portability<a hidden class=anchor aria-hidden=true href=#portability>#</a></h3><p><img loading=lazy src=/blog_imgs/porybility.jpeg alt="Bleeding heart"></p><p>Despite backups and automation, accessibility remains crucial.</p><p><em>Can we access our files on the fly from another computer or sytsem?</em></p><p>Usually, when we have a snapshot or a configuration, we have to install the particular operating system.</p><p>This is time-consuming and sometimes isn&rsquo;t even possible</p><p><em>(for example, when you are using someone else&rsquo;s computer or you have Windows installed)</em> .</p><h3 id=virutalization-the--queen-of-the-flexabilty>Virutalization the queen of the flexabilty<a hidden class=anchor aria-hidden=true href=#virutalization-the--queen-of-the-flexabilty>#</a></h3><p><img loading=lazy src=/blog_imgs/dokcer_Logo.png alt="Docker Logo">
When it comes to quick and easy solutions, containers immediately comes to mind.</p><p>They offer a rapid and straightforward approach: install everything you need in the container, push it to <a href=https://hub.docker.com/>Dockerhub</a>, and Pccess it from anywhere you want.</p><p><em>Higly encourage to have the container withh all of ur&rsquo;e little tools</em></p><p>You can even build <strong>container-based</strong> solutions or troubleshoot issues on the target network.</p><p>Containers are quick, simple, and resource-efficient. However, for our daily driver, we&rsquo;re looking for something more versatile and robust</p><h3 id=just--use--vms>Just use Vms<a hidden class=anchor aria-hidden=true href=#just--use--vms>#</a></h3><p><img loading=lazy src=/blog_imgs/VMware-logo.webp alt="Vmare Logo">
This article can be summed up in just one line.</p><p><em><strong>Embrace VMs, and you&rsquo;re set. Why?</strong></em></p><p>-They are <strong>easy to backup</strong>; you just create snapshots regularly.</p><p>-You can test things and <strong>revert to the previous state</strong> or copy them every way you want.</p><p>-They are <strong>extremely portable</strong>; you can have the image on a USB drive and boot it on almost any computer.</p><p>-Plus, <a href=https://blogs.vmware.com/workstation/2024/05/vmware-workstation-pro-now-available-free-for-personal-use.html>VMware Pro</a> is now free on Windows.</p><p>If you&rsquo;re not using VMs, just stop reading here and install one&mldr;</p><h3 id=ventoy-the-swiss-army-knife-of-usb-sticks>Ventoy: The Swiss Army Knife of USB Sticks<a hidden class=anchor aria-hidden=true href=#ventoy-the-swiss-army-knife-of-usb-sticks>#</a></h3><p><img loading=lazy src=/blog_imgs/ventoy_logo.jpg alt="Ventoy Logo"></p><p>Here in Poland, we were recently advised to have a backpack with essential items just in case something happens.</p><p>These essentials include canned food, fresh water, and toilet paper.</p><p>However, no one mentioned the importance of having a <strong>USB stick</strong>.</p><p>What if a power outage occurs?</p><p>There will be no time to download disk passwords or, more importantly, ISO files.</p><p>That&rsquo;s why you should know about <a href=https://www.ventoy.net/en/index.html>Ventoy</a>.</p><p>You probably use Rufus or Balena Etcher to flash your USB drive.</p><p>But what if I told you that you could have <em>all your VM ISOs,
files, and family photos</em> on <strong>one pen drive</strong>?</p><p><strong>Ventoy</strong> does that for you.</p><p>Go read about it and be prepared for anything.</p><p>You might laugh at me, but how would you know that the computer you happen to find wasn&rsquo;t compromised or doesn&rsquo;t have the tools you need to survive? Or there could be network limitations.</p><h3 id=to-sum-up>To sum up<a hidden class=anchor aria-hidden=true href=#to-sum-up>#</a></h3><p>So, next time you&rsquo;re diving into the digital land, remember these simple rules:</p><p><strong>Back it up, make it reproducible, and keep it portable.</strong></p><p>These steps can save you a world of headache when disaster strikes.</p><p>So, keep tinkering, keep exploring, and above all, keep your system running like a champ.</p><p>Because in a world of chaos, your tech setup should be the calm in the storm.</p><p><em>Don&rsquo;t break easy, preserve that best version of your system!</em></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/linux/docker/docker/><span class=title>« Prev</span><br><span>docker</span>
</a><a class=next href=http://localhost:1313/posts/network/phisicall/dsl/><span class=title>Next »</span><br><span>DSL</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/>ExampleSite</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>